<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Stove control</title>
    <style>
      * {box-sizing: border-box;}
      body {
        background-color: rgb(26, 32, 40);
        color: rgb(243, 249, 255);
        font-family: sans-serif;
        margin: 0;
      }
      header {
        overflow: hidden;
        background-color: rgb(46, 57, 70);
        padding: 10px 10px;
        padding-left: 20px;
        margin-bottom: 20px;
      }
      header h1 {
        font-size: 160%;
        color: rgb(184, 198, 211);
      }
      div.info, div.control {
        display: block;
        float: left;
        width: 100%;
        font-size: 120%;
        padding: 10px;
        margin: auto;
        vertical-align: middle;
      }
      div.label {
        min-width: 250px;
        float: left;
        color: rgb(138, 141, 144);
        margin-top: 2px;
      }
      div.value {
        float: left;
        font-weight: bold;
        font-size: 120%;
      }
      div.control {
        vertical-align: middle;
        margin-bottom: 20px;
      }
      button.green {
        background-color: rgb(24, 58, 24);
      }
      button.red {
        background-color: rgb(76, 34, 34);
      }
      button.blue {
        background-color: rgb(39, 46, 86);
      }
      button.control {
        border: 1px rgb(138, 141, 144);
        color:rgb(243, 249, 255);
        font-family: sans-serif;
        font-size: 120%;
        padding: 10px;
        border-radius: 5px;
      }
      button#btn_ctrl {
        min-width: 200px;
      }
    </style>
  </head>
  <body>

    <header>
      <h1>Stove controller</h1>  
    </header>

    <main>
      <div class="control">
        <button id="btn_ctrl" class="control green">Turn stove OFF</button>
        <button id="btn_pwrdwn" class="control green">Power -</button>
        <button id="btn_pwrup" class="control green">Power +</button>
    </div>
      <div class="info">
        <div class="label">Stove state</div>
        <div class="value" id="val_state">OFF</div>
      </div>
      <div class="info">
        <div class="label">Power</div>
        <div class="value" id="val_pwr"">3</div>
      </div>
      <div class="info">
        <div class="label">Ambient temperature</div>
        <div class="value" id="val_ambtemp">6.5°C</div>
      </div>
      <div class="info">
        <div class="label">Fumes temperature</div>
        <div class="value" id="val_fumestemp">10°C</div>
      </div>
      <div class="info">
        <div class="label">Fumes Fan speed</div>
        <div class="value" id="val_fanspeed">1500 RPM</div>
      </div>
    </main>
    <script lang="text/javascript">
        // define global vars
        var refresh_time = 10; // time in secs 
        var refresh_timer = false;
        var stove_running = false;
        var state = {
          state: "0x01",
          power: "0x01",
          ambient: "0x08",
          fumes: "0x15",
          fan: "0x00"
        };
        var btn_ctrl = document.getElementById('btn_ctrl');
        var btn_ctrl_confirm_state = false;

        // define helper functions
        
        function update_ctrl_button_state(){
          if (stove_running) {
            btn_ctrl.innerText="Turn Stove OFF";
            btn_ctrl.classList.remove('green');
            btn_ctrl.classList.add('red');
          } else {
            btn_ctrl.innerText="Turn Stove ON";
            btn_ctrl.classList.remove('red');
            btn_ctrl.classList.add('green');
          }
        }
        function update_stove_state(){
          console.log("fetch current stove state");
          refresh_timer = setTimeout(update_stove_state, refresh_time*1000);
        }


        // onload do first fetch
        window.addEventListener("load", (event) => {
          update_stove_state();
        });

        // add button events
        btn_ctrl.addEventListener('click', ()=>{
          if (!btn_ctrl_confirm_state){
            btn_ctrl_confirm_state = true;
            btn_ctrl.innerText="Confirm";
            return;
          }
          btn_ctrl_confirm_state = false;
          if (!stove_running){
            console.log("turn stove ON");
            stove_running=true;
          } else {
            console.log("turn stove OFF");
            stove_running=false;
          }
          update_ctrl_button_state();
        });



    </script>
  </body>
</html>
